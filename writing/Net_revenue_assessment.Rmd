---
title: "Profit_Assessment"
author: "Min-Yang Lee"
date: "`r format(Sys.time(), '%B %d, %Y')`" 
output: 
  bookdown::pdf_document2:
    toc: False
    fig_caption: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
knitr::opts_chunk$set(warning = FALSE)
knitr::opts_chunk$set(comment = FALSE)
knitr::opts_chunk$set(error = FALSE)
knitr::opts_chunk$set(message = FALSE)

library(here)
library(tidyverse)
library(data.table)
library(reshape2)
library(ggpubr)
library(kableExtra)
library(glue)
```


```{r readin_data, include=FALSE}
here::i_am("writing/Net_revenue_assessment.Rmd")

vintage_string<-list.files(here("data_folder","main"), pattern=glob2rx("net_revenue_data_*Rds"))
vintage_string<-gsub("net_revenue_data_","",vintage_string)
vintage_string<-gsub(".Rds","",vintage_string)
vintage_string<-max(vintage_string)

CAMS_Trip_Revenue<-readRDS(file=here("data_folder", "main", glue("net_revenue_data_{vintage_string}.Rds")))
```

## Introduction
I present a net revenue assessment (gross revenue minus trip costs, for federally reporting trips) between the years 2021 - 2024.  All dollar values are reported in $2024 real values.

The underlying data does not currently include information for trips in which there is a valid trip report but no corresponding dealer report. 

# Data

## Gross Revenues

Gross revenues were pulled from CAMS, excluding oyster.  It probably makes more sense to pull only the federally managed species.

## Cost Coverage

As background, Figure \@ref(fig:coverage) presents an overview of gross revenue from federal trips, for which costs can be calculated, versus gross revenue for which trip costs cannot be computed. 

```{r coverage, fig.cap="Gross revenue grouped by federally permitted and non-federally permitted trips, by region.", warnings=FALSE, comment=FALSE,error=FALSE, message=FALSE}

Cost_Coverage <- CAMS_Trip_Revenue %>%
  mutate(Missing= "Net Revenue Possible",
    Missing= ifelse(is.na(Real_Cost),"Missing Costs", Missing)) %>%
  group_by(Missing,YEAR) %>%
  dplyr::summarise(Total_revenue=sum(Real_Revenue,na.rm = TRUE)) %>% ungroup()

ggplot(Cost_Coverage,aes(x=YEAR,y=Total_revenue/1000000,colour=Missing))+
  geom_line(stat="identity")+ expand_limits(y = 0)+ theme(axis.text.x = element_text(angle=90, hjust=1))+labs(y="Total Revenue ($2024 Million)",x="Year")
```

## Net Revenue

Figure \@ref(fig:coverage) presents the summed net revenue estimates for federally permitted trips.

```{r netrev, echo=FALSE, fig.cap="Net revenue generated by federally permitted trips."}
Net_revenue <- CAMS_Trip_Revenue %>% 
  filter(!is.na(VTR_TRIPID)) %>%
  group_by(YEAR) %>%
    dplyr::summarise(Net_Revenue =sum(Net_Revenue, na.rm=TRUE)) %>% ungroup()

#Useful plots

ggplot(Net_revenue, aes(x=YEAR,y=Net_Revenue/1000000))+
  geom_line()+ expand_limits( y = 0)+labs(y="Net Revenue ($2024 Million)",x="Year")

```

Although net revenue is the most-oft assessed metric of profitability in fisheries management, the fact that 25-50\% of trip revenue is excluded from this analysis has been a serious deficiency pointed out by both the SSC and Council, particularly through its Ecosystem and Ocean Planning Committee.


```
